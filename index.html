<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üéÑ –†—ñ–∑–¥–≤—è–Ω–∞ –ú–∞–≥—ñ—á–Ω–∞ –ö—É–ª—è</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.3/dist/mindar-image-aframe.prod.js"></script>

    <!-- üîÆ –ö–∞—Å—Ç–æ–º–Ω–∏–π —à–µ–π–¥–µ—Ä "—Å–∫–ª–æ" -->
    <script>
      AFRAME.registerShader('glass', {
        schema: {
          color: { type: 'color', default: '#00b0ff' },
          opacity: { type: 'number', default: 0.35 },
          shininess: { type: 'number', default: 100 }
        },
        vertexShader: `
          varying vec3 vNormal;
          varying vec3 vPosition;
          void main() {
            vNormal = normalize(normalMatrix * normal);
            vPosition = (modelViewMatrix * vec4(position, 1.0)).xyz;
            gl_Position = projectionMatrix * vec4(vPosition, 1.0);
          }
        `,
        fragmentShader: `
          varying vec3 vNormal;
          varying vec3 vPosition;
          uniform vec3 color;
          uniform float opacity;
          uniform float shininess;
          void main() {
            vec3 lightDir = normalize(vec3(1.0, 1.0, 1.0));
            float diff = max(dot(normalize(vNormal), lightDir), 0.1);
            vec3 diffuse = diff * color;

            vec3 viewDir = normalize(-vPosition);
            vec3 reflectDir = reflect(-lightDir, normalize(vNormal));
            float spec = pow(max(dot(viewDir, reflectDir), 0.0), shininess);
            vec3 specular = spec * vec3(1.0, 1.0, 1.0);

            gl_FragColor = vec4(mix(diffuse, specular, 0.3), opacity);
          }
        `
      });
    </script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { width: 100%; height: 100%; overflow: hidden; background: transparent; color: white; }
        a-scene { position: fixed; top: 0; left: 0; width: 100% !important; height: 100% !important; background: transparent; }
        .loader {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: rgba(10, 15, 44, 0.8); z-index: 1000; text-align: center; padding: 20px;
        }
        .loader h1 {
            font-size: 2em; margin-bottom: 15px;
            text-shadow: 0 0 15px #00b0ff;
            animation: glow 2s infinite alternate;
        }
        @keyframes glow {
            to { text-shadow: 0 0 25px #ff00ff, 0 0 35px #00b0ff; }
        }
        .sound-btn {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            padding: 12px 24px; border: none; border-radius: 24px;
            background: linear-gradient(45deg, #00b0ff, #ff00ff); color: white;
            font-weight: bold; cursor: pointer; z-index: 1001;
        }
    </style>
</head>
<body>
    <div class="loader" id="loader">
        <h1>üéÑ –†—ñ–∑–¥–≤—è–Ω–∞ –ú–∞–≥—ñ—á–Ω–∞ –ö—É–ª—è</h1>
        <p>–ù–∞–≤–µ–¥–∏ –∫–∞–º–µ—Ä—É –Ω–∞ –º–∞—Ä–∫–µ—Ä!</p>
    </div>

    <a-scene
        mindar-image="imageTargetSrc: assets/marker.mind; maxTrack: 1"
        embedded
        renderer="colorManagement: true; physicallyCorrectLights: true;"
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false"
        loading-screen="enabled: false"
    >
        <a-assets>
            <audio id="bg-music" src="fon.mp3" preload="auto" loop></audio>
        </a-assets>

        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

        <a-entity mindar-image-target="targetIndex: 0">
            <!-- üíé –°–ö–õ–Ø–ù–ê –ö–£–õ–Ø –∑ –∫–∞—Å—Ç–æ–º–Ω–∏–º —à–µ–π–¥–µ—Ä–æ–º -->
            <a-sphere
                id="magic-sphere"
                radius="0.8"
                position="0 0 0"
                material="shader: glass; color: #00b0ff; opacity: 0.35; shininess: 120"
                side="double"
                visible="false"
            >
                <a-animation
                    attribute="rotation"
                    to="0 360 0"
                    dur="10000"
                    repeat="indefinite"
                    easing="linear"
                ></a-animation>
            </a-sphere>
        </a-entity>
    </a-scene>

    <button class="sound-btn" id="sound-btn">üîä –£–≤—ñ–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫</button>

    <script>
        const loader = document.getElementById('loader');
        const sphere = document.getElementById('magic-sphere');
        const bgMusic = document.getElementById('bg-music');
        const soundBtn = document.getElementById('sound-btn');
        let isTargetActive = false;

        // –ü—Ä–æ—Ä–æ—Ü—Ç–≤–æ
        function showProphecy() {
            const parent = sphere.parentNode;
            const message = "–©–∞—Å–ª–∏–≤–æ–≥–æ –†—ñ–∑–¥–≤–∞!";

            // –í–∏–¥–∞–ª—è—î–º–æ —Å—Ç–∞—Ä–∏–π
            [...parent.querySelectorAll('[data-prophecy]')].forEach(el => el.remove());

            const text = document.createElement('a-text');
            text.setAttribute('value', message);
            text.setAttribute('position', '0 0 0.75');
            text.setAttribute('color', '#FFD700');
            text.setAttribute('width', '2.6');
            text.setAttribute('align', 'center');
            text.setAttribute('font', 'https://cdn.aframe.io/fonts/Roboto-msdf.json');
            text.setAttribute('opacity', '0');
            text.setAttribute('animation__fade', 'property: opacity; from: 0; to: 1; dur: 1000; easing: easeOutCubic');
            text.setAttribute('data-prophecy', 'true');

            parent.appendChild(text);
            setTimeout(() => text.emit('fadein'), 100);

            setTimeout(() => {
                if (text.parentNode) {
                    text.setAttribute('animation__out', 'property: opacity; to: 0; dur: 800; startEvents: fadeout');
                    text.emit('fadeout');
                    setTimeout(() => { if (text.parentNode) text.parentNode.removeChild(text); }, 800);
                }
            }, 4000);
        }

        // –û–±—Ä–æ–±–∫–∞ –º–∞—Ä–∫–µ—Ä–∞
        const target = document.querySelector('[mindar-image-target]');
        if (target) {
            target.addEventListener('targetFound', () => {
                isTargetActive = true;
                loader.style.display = 'none';
                sphere.setAttribute('visible', 'true');
                if (bgMusic.paused) {
                    bgMusic.play().catch(e => console.log("üîá Audio failed:", e));
                    soundBtn.textContent = 'üîä –í–∏–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫';
                }
            });
            target.addEventListener('targetLost', () => {
                isTargetActive = false;
                loader.style.display = 'flex';
                sphere.setAttribute('visible', 'false');
                if (!bgMusic.paused) bgMusic.pause();
                soundBtn.textContent = 'üîä –£–≤—ñ–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫';
            });
        }

        // üî• –ù–∞–¥—ñ–π–Ω–∏–π –∫–ª—ñ–∫ –Ω–∞ –º–æ–±—ñ–ª—Ü—ñ
        document.body.addEventListener('touchstart', (e) => {
            if (isTargetActive) {
                e.preventDefault();
                showProphecy();
            }
        }, { passive: false });

        soundBtn.addEventListener('click', () => {
            if (bgMusic.paused) {
                bgMusic.play().catch(e => console.log("üîá Audio failed:", e));
                soundBtn.textContent = 'üîä –í–∏–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫';
            } else {
                bgMusic.pause();
                soundBtn.textContent = 'üîä –£–≤—ñ–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫';
            }
        });
    </script>
</body>
</html>

