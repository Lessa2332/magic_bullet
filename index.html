<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üéÑ –†—ñ–∑–¥–≤—è–Ω–∞ –ú–∞–≥—ñ—á–Ω–∞ –ö—É–ª—è</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.3/dist/mindar-image-aframe.prod.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { 
            width: 100%; height: 100%; overflow: hidden; 
            background: #000;
            font-family: Arial, sans-serif;
        }
        a-scene { 
            position: fixed; top: 0; left: 0; 
            width: 100% !important; height: 100% !important; 
            background: transparent; 
        }

        /* –ö–Ω–æ–ø–∫–∞ –∑–≤—É–∫—É ‚Äî –∑–æ–≤–Ω—ñ —Å—Ü–µ–Ω–∏, –∞–ª–µ –Ω–µ –ø–µ—Ä–µ–∫—Ä–∏–≤–∞—î—Ç—å—Å—è */
        #sound-btn {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10000;
            padding: 12px 24px;
            border: none;
            border-radius: 24px;
            background: linear-gradient(45deg, #00b0ff, #ff00ff);
            color: white;
            font-weight: bold;
            cursor: pointer;
            font-size: 1em;
            pointer-events: auto; /* –≤–∞–∂–ª–∏–≤–æ! */
        }
    </style>
</head>
<body>
    <!-- üîä –ö–Ω–æ–ø–∫–∞ –∑–≤—É–∫—É ‚Äî –ó–û–í–ù–Ü —Å—Ü–µ–Ω–∏, –∞–ª–µ –∑ –≤–∏—Å–æ–∫–∏–º z-index -->
    <button id="sound-btn">üîä –£–≤—ñ–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫</button>

    <a-scene
        mindar-image="imageTargetSrc: assets/marker.mind; maxTrack: 1"
        embedded
        renderer="colorManagement: true; physicallyCorrectLights: true;"
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false"
        loading-screen="enabled: false"
        cursor="rayOrigin: mouse"
    >
        <a-assets>
            <audio id="bg-music" src="fon.mp3" preload="auto" loop></audio>
        </a-assets>

        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

        <a-entity mindar-image-target="targetIndex: 0">
            <a-sphere
                id="magic-sphere"
                radius="0.8"
                position="0 0 0"
                material="
                    color: #00b0ff;
                    transparent: true;
                    opacity: 0.35;
                    shader: standard;
                    emissive: #0080ff;
                    emissiveIntensity: 0.2;
                    metalness: 0.1;
                    roughness: 0.3;
                    side: double
                "
                visible="false"
            >
                <a-animation
                    attribute="rotation"
                    to="0 360 0"
                    dur="10000"
                    repeat="indefinite"
                ></a-animation>
            </a-sphere>
        </a-entity>

        <!-- –õ–æ–∞–¥–µ—Ä (–≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Å—Ü–µ–Ω–∏) -->
        <a-entity id="loader" position="0 0 -2" visible="true">
            <a-plane width="3" height="1.2" color="#0a0f2c" opacity="0.8" side="double"></a-plane>
            <a-text value="–ù–∞–≤–µ–¥–∏ –∫–∞–º–µ—Ä—É –Ω–∞ –º–∞—Ä–∫–µ—Ä!" align="center" color="#00b0ff" width="2.5" position="0 0 0.01"></a-text>
        </a-entity>
    </a-scene>

    <script>
        const bgMusic = document.getElementById('bg-music');
        const loader = document.getElementById('loader');
        const sphere = document.getElementById('magic-sphere');
        const soundBtn = document.getElementById('sound-btn');
        let isTargetActive = false;

        // üîä –ö–Ω–æ–ø–∫–∞ –∑–≤—É–∫—É ‚Äî –Ω–µ–∑–∞–ª–µ–∂–Ω–∞ –≤—ñ–¥ AR
        soundBtn.addEventListener('click', () => {
            if (bgMusic.paused) {
                bgMusic.play().catch(e => console.log("üîá Audio failed:", e));
                soundBtn.textContent = 'üîä –í–∏–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫';
            } else {
                bgMusic.pause();
                soundBtn.textContent = 'üîä –£–≤—ñ–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫';
            }
        });

        // –ü–æ–∫–∞–∑ –ø—Ä–æ—Ä–æ—Ü—Ç–≤–∞ –ù–ê –ï–ö–í–ê–¢–û–†–Ü
        function showProphecy() {
            const parent = sphere.parentNode;
            const message = "–©–∞—Å–ª–∏–≤–æ–≥–æ –†—ñ–∑–¥–≤–∞!";

            // –í–∏–¥–∞–ª—è—î–º–æ —Å—Ç–∞—Ä–∏–π —Ç–µ–∫—Å—Ç
            [...parent.querySelectorAll('[data-prophecy]')].forEach(el => el.remove());

            // –¢–µ–∫—Å—Ç –Ω–∞ –µ–∫–≤–∞—Ç–æ—Ä—ñ: Y=0, Z=0.85 (—Ç—Ä–æ—Ö–∏ –ø–æ–ø–µ—Ä–µ–¥—É –∫—É–ª—ñ)
            const text = document.createElement('a-text');
            text.setAttribute('value', message);
            text.setAttribute('position', '0 0 0.85'); // ‚Üê –æ—Å—å —Ç—É—Ç ‚Äî –µ–∫–≤–∞—Ç–æ—Ä!
            text.setAttribute('color', '#FFD700');
            text.setAttribute('width', '2.4');
            text.setAttribute('align', 'center');
            text.setAttribute('font', 'https://cdn.aframe.io/fonts/Roboto-msdf.json');
            text.setAttribute('opacity', '0');
            text.setAttribute('animation__fade', 'property: opacity; from: 0; to: 1; dur: 1000; easing: easeOutCubic');
            text.setAttribute('data-prophecy', 'true');
            text.setAttribute('side', 'double');

            parent.appendChild(text);
            setTimeout(() => text.emit('fadein'), 100);

            setTimeout(() => {
                if (text.parentNode) {
                    text.setAttribute('animation__out', 'property: opacity; to: 0; dur: 800; startEvents: fadeout');
                    text.emit('fadeout');
                    setTimeout(() => { if (text.parentNode) text.parentNode.removeChild(text); }, 800);
                }
            }, 4000);
        }

        // –û–±—Ä–æ–±–∫–∞ –º–∞—Ä–∫–µ—Ä–∞
        const target = document.querySelector('[mindar-image-target]');
        if (target) {
            target.addEventListener('targetFound', () => {
                isTargetActive = true;
                loader.setAttribute('visible', 'false');
                sphere.setAttribute('visible', 'true');
            });

            target.addEventListener('targetLost', () => {
                isTargetActive = false;
                loader.setAttribute('visible', 'true');
                sphere.setAttribute('visible', 'false');
                // –ü—Ä–∏ –≤—Ç—Ä–∞—Ç—ñ –º–∞—Ä–∫–µ—Ä–∞ ‚Äî –ø—Ä–∏—Ö–æ–≤—É—î–º–æ –ø—Ä–æ—Ä–æ—Ü—Ç–≤–æ
                [...sphere.parentNode.querySelectorAll('[data-prophecy]')].forEach(el => el.remove());
            });
        }

        // ‚úÖ –ö–ª—ñ–∫ –ø–æ –∫—É–ª—ñ ‚Üí –ø—Ä–æ—Ä–æ—Ü—Ç–≤–æ
        sphere.addEventListener('click', (evt) => {
            if (isTargetActive) {
                evt.preventDefault();
                showProphecy();
                console.log("‚ú® –ü—Ä–æ—Ä–æ—Ü—Ç–≤–æ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ!");
            }
        });

        // üì± –ú–æ–±—ñ–ª—å–Ω–∏–π fallback: —Ç–æ—Ä–∫–∞–Ω–Ω—è –µ–∫—Ä–∞–Ω—É (–æ–∫—Ä—ñ–º –∫–Ω–æ–ø–∫–∏) ‚Üí –ø—Ä–æ—Ä–æ—Ü—Ç–≤–æ
        document.body.addEventListener('touchstart', (e) => {
            if (isTargetActive) {
                // –Ø–∫—â–æ —Ç–æ—Ä–∫–Ω—É–ª–∏—Å—è –Ω–µ –∫–Ω–æ–ø–∫–∏ ‚Äî –∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏ –ø—Ä–æ—Ä–æ—Ü—Ç–≤–æ
                if (!e.target.closest('#sound-btn')) {
                    e.preventDefault();
                    showProphecy();
                }
            }
        }, { passive: false });
    </script>
</body>
</html>
