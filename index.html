<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üéÑ –†—ñ–∑–¥–≤—è–Ω–∞ –ú–∞–≥—ñ—á–Ω–∞ –ö—É–ª—è</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.3/dist/mindar-image-aframe.prod.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: transparent;
            font-family: 'Arial Rounded MT Bold', Arial, sans-serif;
            color: white;
        }

        a-scene {
            position: fixed;
            top: 0;
            left: 0;
            width: 100% !important;
            height: 100% !important;
            background: transparent;
        }

        .loader {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(10, 15, 44, 0.8);
            z-index: 1000;
            text-align: center;
            padding: 20px;
        }

        .loader h1 {
            font-size: 2em;
            margin-bottom: 15px;
            text-shadow: 0 0 15px #00b0ff;
            animation: glow 2s infinite alternate;
        }

        .loader p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        @keyframes glow {
            from { text-shadow: 0 0 10px #00b0ff; }
            to { text-shadow: 0 0 20px #ff00ff, 0 0 30px #00b0ff; }
        }

        .sound-btn {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1001;
            padding: 12px 24px;
            border: none;
            border-radius: 24px;
            background: linear-gradient(45deg, #00b0ff, #ff00ff);
            color: white;
            font-weight: bold;
            cursor: pointer;
            font-size: 1em;
        }
    </style>
</head>
<body>
    <div class="loader" id="loader">
        <h1>üéÑ –†—ñ–∑–¥–≤—è–Ω–∞ –ú–∞–≥—ñ—á–Ω–∞ –ö—É–ª—è</h1>
        <p>–ù–∞–≤–µ–¥–∏ –∫–∞–º–µ—Ä—É –Ω–∞ –º–∞—Ä–∫–µ—Ä!</p>
    </div>

    <!-- –î–æ–¥–∞–Ω–æ: cursor="rayOrigin: mouse" -->
    <a-scene
        mindar-image="imageTargetSrc: assets/marker.mind; maxTrack: 1"
        embedded
        renderer="colorManagement: true; physicallyCorrectLights: true;"
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false"
        loading-screen="enabled: false"
        cursor="rayOrigin: mouse"  <!-- üîë –¶–ï –ì–û–õ–û–í–ù–ï! -->
    >
        <a-assets>
            <audio id="bg-music" src="fon.mp3" preload="auto" loop></audio>
        </a-assets>

        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

        <a-entity mindar-image-target="targetIndex: 0">
            <a-sphere
                id="magic-sphere"
                radius="0.8"
                position="0 0 0"
                material="
                    color: #00b0ff;
                    transparent: true;
                    opacity: 0.35;
                    shader: flat;
                    side: double
                "
                visible="false"
            >
                <a-animation
                    attribute="rotation"
                    to="0 360 0"
                    dur="8000"
                    repeat="indefinite"
                ></a-animation>
            </a-sphere>
        </a-entity>
    </a-scene>

    <button class="sound-btn" id="sound-btn">üîä –£–≤—ñ–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫</button>

    <script>
        const loader = document.getElementById('loader');
        const sphere = document.getElementById('magic-sphere');
        const bgMusic = document.getElementById('bg-music');
        const soundBtn = document.getElementById('sound-btn');

        let prophecyText = null;
        let prophecyShadow = null;

        function showProphecy() {
            const parent = sphere.parentNode;

            if (prophecyText) {
                parent.removeChild(prophecyText);
                prophecyText = null;
            }
            if (prophecyShadow) {
                parent.removeChild(prophecyShadow);
                prophecyShadow = null;
            }

            const message = "–©–∞—Å–ª–∏–≤–æ–≥–æ –†—ñ–∑–¥–≤–∞!";

            prophecyShadow = document.createElement('a-text');
            prophecyShadow.setAttribute('value', message);
            prophecyShadow.setAttribute('position', '0 0 0.75');
            prophecyShadow.setAttribute('color', '#000');
            prophecyShadow.setAttribute('opacity', '0.6');
            prophecyShadow.setAttribute('width', '2.6');
            prophecyShadow.setAttribute('align', 'center');
            prophecyShadow.setAttribute('font', 'https://cdn.aframe.io/fonts/Roboto-msdf.json');

            prophecyText = document.createElement('a-text');
            prophecyText.setAttribute('value', message);
            prophecyText.setAttribute('position', '0 0 0.75');
            prophecyText.setAttribute('color', '#FFD700');
            prophecyText.setAttribute('width', '2.6');
            prophecyText.setAttribute('align', 'center');
            prophecyText.setAttribute('font', 'https://cdn.aframe.io/fonts/Roboto-msdf.json');
            prophecyText.setAttribute('opacity', '0');
            prophecyText.setAttribute('animation__fade', 'property: opacity; from: 0; to: 1; dur: 1000; easing: easeOutCubic');

            parent.appendChild(prophecyShadow);
            parent.appendChild(prophecyText);

            setTimeout(() => {
                if (prophecyText) prophecyText.emit('fadein');
            }, 100);

            setTimeout(() => {
                if (prophecyText && prophecyText.parentNode) {
                    prophecyText.setAttribute('animation__out', 'property: opacity; to: 0; dur: 800; startEvents: fadeout');
                    prophecyText.emit('fadeout');
                    setTimeout(() => {
                        if (prophecyText.parentNode) prophecyText.parentNode.removeChild(prophecyText);
                        if (prophecyShadow.parentNode) prophecyShadow.parentNode.removeChild(prophecyShadow);
                        prophecyText = null;
                        prophecyShadow = null;
                    }, 800);
                }
            }, 4000);
        }

        // üî• –ì–û–õ–û–í–ù–ï: –æ–±—Ä–æ–±–∫–∞ –∫–ª—ñ–∫—É —á–µ—Ä–µ–∑ A-Frame –ø–æ–¥—ñ—é
        sphere.addEventListener('click', (evt) => {
            evt.preventDefault();
            evt.stopPropagation();
            showProphecy();
            console.log("–ö–ª—ñ–∫ –ø–æ –∫—É–ª—ñ ‚Äî –ø—Ä–æ—Ä–æ—Ü—Ç–≤–æ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ!");
        });

        const target = document.querySelector('[mindar-image-target]');
        if (target) {
            target.addEventListener('targetFound', () => {
                loader.style.display = 'none';
                sphere.setAttribute('visible', 'true');
                if (bgMusic.paused) {
                    bgMusic.play().catch(e => console.log("üîá Audio play failed:", e));
                    soundBtn.textContent = 'üîä –í–∏–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫';
                }
            });

            target.addEventListener('targetLost', () => {
                loader.style.display = 'flex';
                sphere.setAttribute('visible', 'false');
                if (!bgMusic.paused) bgMusic.pause();
                soundBtn.textContent = 'üîä –£–≤—ñ–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫';
            });
        }

        soundBtn.addEventListener('click', () => {
            if (bgMusic.paused) {
                bgMusic.play().catch(e => console.log("üîá Audio play failed:", e));
                soundBtn.textContent = 'üîä –í–∏–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫';
            } else {
                bgMusic.pause();
                soundBtn.textContent = 'üîä –£–≤—ñ–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫';
            }
        });
    </script>
</body>
</html>
