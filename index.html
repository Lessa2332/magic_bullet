<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üéÑ –†—ñ–∑–¥–≤—è–Ω–∞ –ú–∞–≥—ñ—á–Ω–∞ –ö—É–ª—è</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.3/dist/mindar-image-aframe.prod.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { 
            width: 100%; height: 100%; overflow: hidden; 
            background: #000; /* —á–æ—Ä–Ω–∏–π, –±–æ –≤—ñ–¥–µ–æ –ø–µ—Ä–µ–∫—Ä–∏—î */
        }
        a-scene { 
            position: fixed; top: 0; left: 0; 
            width: 100% !important; height: 100% !important; 
            background: transparent; 
        }
    </style>
</head>
<body>
    <a-scene
        mindar-image="imageTargetSrc: assets/marker.mind; maxTrack: 1"
        embedded
        renderer="colorManagement: true; physicallyCorrectLights: true;"
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false"
        loading-screen="enabled: false"
    >
        <!-- –ê—É–¥—ñ–æ -->
        <a-assets>
            <audio id="bg-music" src="fon.mp3" preload="auto" loop></audio>
        </a-assets>

        <!-- –ö–∞–º–µ—Ä–∞ -->
        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

        <!-- –ú–∞—Ä–∫–µ—Ä -->
        <a-entity mindar-image-target="targetIndex: 0">
            <a-sphere
                id="magic-sphere"
                radius="0.8"
                position="0 0 0"
                material="
                    color: #00b0ff;
                    transparent: true;
                    opacity: 0.35;
                    shader: standard;
                    emissive: #0080ff;
                    emissiveIntensity: 0.2;
                    metalness: 0.1;
                    roughness: 0.3;
                    side: double
                "
                visible="false"
            >
                <a-animation
                    attribute="rotation"
                    to="0 360 0"
                    dur="10000"
                    repeat="indefinite"
                ></a-animation>
            </a-sphere>
        </a-entity>

        <!-- üí° –õ–û–ê–î–ï–† (–≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Å—Ü–µ–Ω–∏!) -->
        <a-entity id="loader" position="0 0 -2" visible="true">
            <a-plane 
                width="3" height="2" 
                color="#0a0f2c" 
                opacity="0.85" 
                side="double"
                position="0 0 0"
            ></a-plane>
            <a-text 
                value="üéÑ –†—ñ–∑–¥–≤—è–Ω–∞ –ú–∞–≥—ñ—á–Ω–∞ –ö—É–ª—è" 
                position="0 0.4 0.01" 
                align="center" 
                color="#00b0ff" 
                width="2.8"
                font="https://cdn.aframe.io/fonts/Roboto-msdf.json"
            ></a-text>
            <a-text 
                value="–ù–∞–≤–µ–¥–∏ –∫–∞–º–µ—Ä—É –Ω–∞ –º–∞—Ä–∫–µ—Ä!" 
                position="0 -0.2 0.01" 
                align="center" 
                color="#ffffff" 
                width="2.8"
                font="https://cdn.aframe.io/fonts/Roboto-msdf.json"
            ></a-text>
        </a-entity>

        <!-- üîä –ö–ù–û–ü–ö–ê –ó–í–£–ö–£ (–≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Å—Ü–µ–Ω–∏!) -->
        <a-entity id="sound-ui" position="0 -1.2 -2">
            <a-plane 
                id="sound-btn-bg" 
                width="1.6" height="0.4" 
                color="#00b0ff" 
                opacity="0.9" 
                side="double"
                position="0 0 0"
                cursor="rayOrigin: mouse"
                animation__hover="property: scale; to: 1.1 1.1 1.1; startEvents: mouseenter; dur: 200"
                animation__leave="property: scale; to: 1 1 1; startEvents: mouseleave; dur: 200"
            ></a-plane>
            <a-text 
                id="sound-btn-text"
                value="üîä –£–≤—ñ–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫" 
                position="0 0 0.01" 
                align="center" 
                color="#ffffff" 
                width="1.5"
                font="https://cdn.aframe.io/fonts/Roboto-msdf.json"
            ></a-text>
        </a-entity>
    </a-scene>

    <script>
        let isTargetActive = false;
        const bgMusic = document.getElementById('bg-music');
        const loader = document.getElementById('loader');
        const sphere = document.getElementById('magic-sphere');
        const soundBtnBg = document.getElementById('sound-btn-bg');
        const soundBtnText = document.getElementById('sound-btn-text');

        // –ü—Ä–æ—Ä–æ—Ü—Ç–≤–æ
        function showProphecy() {
            const parent = sphere.parentNode;
            const message = "–©–∞—Å–ª–∏–≤–æ–≥–æ –†—ñ–∑–¥–≤–∞!";

            // –í–∏–¥–∞–ª—è—î–º–æ —Å—Ç–∞—Ä–∏–π
            [...parent.querySelectorAll('[data-prophecy]')].forEach(el => el.remove());

            const text = document.createElement('a-text');
            text.setAttribute('value', message);
            text.setAttribute('position', '0 0 0.75');
            text.setAttribute('color', '#FFD700');
            text.setAttribute('width', '2.6');
            text.setAttribute('align', 'center');
            text.setAttribute('font', 'https://cdn.aframe.io/fonts/Roboto-msdf.json');
            text.setAttribute('opacity', '0');
            text.setAttribute('animation__fade', 'property: opacity; from: 0; to: 1; dur: 1000; easing: easeOutCubic');
            text.setAttribute('data-prophecy', 'true');

            parent.appendChild(text);
            setTimeout(() => text.emit('fadein'), 100);

            setTimeout(() => {
                if (text.parentNode) {
                    text.setAttribute('animation__out', 'property: opacity; to: 0; dur: 800; startEvents: fadeout');
                    text.emit('fadeout');
                    setTimeout(() => { if (text.parentNode) text.parentNode.removeChild(text); }, 800);
                }
            }, 4000);
        }

        // –û–±—Ä–æ–±–∫–∞ –º–∞—Ä–∫–µ—Ä–∞
        const target = document.querySelector('[mindar-image-target]');
        if (target) {
            target.addEventListener('targetFound', () => {
                isTargetActive = true;
                loader.setAttribute('visible', 'false');
                sphere.setAttribute('visible', 'true');
                if (bgMusic.paused) {
                    bgMusic.play().catch(e => console.log("üîá Audio failed:", e));
                    soundBtnText.setAttribute('value', 'üîä –í–∏–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫');
                }
            });
            target.addEventListener('targetLost', () => {
                isTargetActive = false;
                loader.setAttribute('visible', 'true');
                sphere.setAttribute('visible', 'false');
                if (!bgMusic.paused) bgMusic.pause();
                soundBtnText.setAttribute('value', 'üîä –£–≤—ñ–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫');
            });
        }

        // –ö–ª—ñ–∫ –ø–æ –∫—É–ª—ñ ‚Üí –ø—Ä–æ—Ä–æ—Ü—Ç–≤–æ
        sphere.addEventListener('click', () => {
            if (isTargetActive) {
                showProphecy();
            }
        });

        // –ö–ª—ñ–∫ –ø–æ –∫–Ω–æ–ø—Ü—ñ –∑–≤—É–∫—É
        soundBtnBg.addEventListener('click', () => {
            if (bgMusic.paused) {
                bgMusic.play().catch(e => console.log("üîá Audio failed:", e));
                soundBtnText.setAttribute('value', 'üîä –í–∏–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫');
            } else {
                bgMusic.pause();
                soundBtnText.setAttribute('value', 'üîä –£–≤—ñ–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫');
            }
        });

        // üì± –ú–æ–±—ñ–ª—å–Ω–∏–π fallback: –±—É–¥—å-—è–∫–µ —Ç–æ—Ä–∫–∞–Ω–Ω—è ‚Üí –ø—Ä–æ—Ä–æ—Ü—Ç–≤–æ (—è–∫—â–æ –º–∞—Ä–∫–µ—Ä –∞–∫—Ç–∏–≤–Ω–∏–π)
        document.body.addEventListener('touchstart', (e) => {
            if (isTargetActive) {
                e.preventDefault();
                // –ù–µ –±–ª–æ–∫—É—î–º–æ, —è–∫—â–æ —Ç–æ—Ä–∫–Ω—É–ª–∏—Å—è –∫–Ω–æ–ø–∫–∏
                const target = e.target;
                if (target.id !== 'sound-btn-bg' && !target.closest('#sound-btn-bg')) {
                    showProphecy();
                }
            }
        }, { passive: false });
    </script>
</body>
</html>
