<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üéÑ –†—ñ–∑–¥–≤—è–Ω–∞ –ú–∞–≥—ñ—á–Ω–∞ –ö—É–ª—è</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.3/dist/mindar-image-aframe.prod.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body {
            width: 100%; height: 100%; overflow: hidden;
            background: #000;
            font-family: Arial, sans-serif;
        }
        a-scene {
            position: fixed; top: 0; left: 0;
            width: 100% !important; height: 100% !important;
            background: transparent;
        }
        /* –ö–Ω–æ–ø–∫–∞ –∑–≤—É–∫—É ‚Äî –∑–æ–≤–Ω—ñ —Å—Ü–µ–Ω–∏, –∞–ª–µ –Ω–µ –ø–µ—Ä–µ–∫—Ä–∏–≤–∞—î—Ç—å—Å—è */
        #sound-btn {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10000;
            padding: 12px 24px;
            border: none;
            border-radius: 24px;
            background: linear-gradient(45deg, #00b0ff, #ff00ff);
            color: white;
            font-weight: bold;
            cursor: pointer;
            font-size: 1em;
            pointer-events: auto; /* –≤–∞–∂–ª–∏–≤–æ! */
        }
    </style>
</head>
<body>
    <!-- üîä –ö–Ω–æ–ø–∫–∞ –∑–≤—É–∫—É ‚Äî –ó–û–í–ù–Ü —Å—Ü–µ–Ω–∏, –∞–ª–µ –∑ –≤–∏—Å–æ–∫–∏–º z-index -->
    <button id="sound-btn">üîä –£–≤—ñ–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫</button>
    <a-scene
        mindar-image="imageTargetSrc: assets/marker.mind; maxTrack: 1"
        embedded
        renderer="colorManagement: true; physicallyCorrectLights: true;"
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false"
        loading-screen="enabled: false"
        cursor="rayOrigin: mouse"
    >
        <a-assets>
            <audio id="bg-music" src="fon.mp3" preload="auto" loop></audio>
            <audio id="prophecy-sound" src="sparkle.mp3" preload="auto"></audio> <!-- –î–æ–¥–∞—Ç–∫–æ–≤–∏–π –∑–≤—É–∫ –¥–ª—è –ø—Ä–æ—Ä–æ—Ü—Ç–≤–∞ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ, –¥–æ–¥–∞–π—Ç–µ —Ñ–∞–π–ª) -->
        </a-assets>
        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>
        <a-entity mindar-image-target="targetIndex: 0">
            <a-sphere
                id="magic-sphere"
                radius="0.8"
                position="0 0 0"
                material="
                    color: #00b0ff;
                    transparent: true;
                    opacity: 0.35;
                    shader: standard;
                    emissive: #0080ff;
                    emissiveIntensity: 0.2;
                    metalness: 0.1;
                    roughness: 0.3;
                    side: double
                "
                visible="false"
            >
                <a-animation
                    attribute="rotation"
                    to="0 360 0"
                    dur="10000"
                    repeat="indefinite"
                ></a-animation>
                <!-- –î–æ–¥–∞—Ç–∫–æ–≤–∏–π –µ—Ñ–µ–∫—Ç –±–ª–∏—Å–∫—É –¥–ª—è –º–∞–≥—ñ—ó -->
                <a-entity id="sparkle-light" light="type: point; intensity: 0; color: #FFD700" position="0 0 0"></a-entity>
            </a-sphere>
            <!-- –°–∏—Å—Ç–µ–º–∞ —á–∞—Å—Ç–∏–Ω–æ–∫ –¥–ª—è –º–∞–≥—ñ—á–Ω–æ–≥–æ –µ—Ñ–µ–∫—Ç—É (–∞–∫—Ç–∏–≤—É—î—Ç—å—Å—è –ø—Ä–∏ –ø—Ä–æ—Ä–æ—Ü—Ç–≤—ñ) -->
            <a-entity id="particles" particle-system="
                preset: dust;
                color: #FFD700,#FF00FF,#00B0FF;
                particleCount: 200;
                velocityValue: 0 0 0;
                velocitySpread: 2 2 2;
                accelerationValue: 0 -9.8 0;
                accelerationSpread: 0 0 0;
                startSize: 0.05;
                endSize: 0.01;
                startOpacity: 1;
                endOpacity: 0;
                duration: 3;
                opacity: 0;
            " position="0 0 0" visible="false"></a-entity>
        </a-entity>
        <!-- –õ–æ–∞–¥–µ—Ä (–≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Å—Ü–µ–Ω–∏) -->
        <a-entity id="loader" position="0 0 -2" visible="true">
            <a-plane width="3" height="1.2" color="#0a0f2c" opacity="0.8" side="double"></a-plane>
            <a-text value="–ù–∞–≤–µ–¥–∏ –∫–∞–º–µ—Ä—É –Ω–∞ –º–∞—Ä–∫–µ—Ä!" align="center" color="#00b0ff" width="2.5" position="0 0 0.01"></a-text>
        </a-entity>
    </a-scene>
    <script>
        const bgMusic = document.getElementById('bg-music');
        const prophecySound = document.getElementById('prophecy-sound');
        const loader = document.getElementById('loader');
        const sphere = document.getElementById('magic-sphere');
        const sparkleLight = document.getElementById('sparkle-light');
        const particles = document.getElementById('particles');
        const soundBtn = document.getElementById('sound-btn');
        let isTargetActive = false;
        
        // –ú–∞—Å–∏–≤ —Ä–∞–Ω–¥–æ–º–Ω–∏—Ö –ø—Ä–æ—Ä–æ—Ü—Ç–≤ –¥–ª—è –º–∞–≥—ñ—á–Ω–æ–≥–æ –µ—Ñ–µ–∫—Ç—É
        const prophecies = [
            "–©–∞—Å–ª–∏–≤–æ–≥–æ –†—ñ–∑–¥–≤–∞!",
            "–ë–∞–∂–∞—é –¥–∏–≤–∞ –≤ –ù–æ–≤–æ–º—É —Ä–æ—Ü—ñ!",
            "–ù–µ—Ö–∞–π –º—Ä—ñ—ó –∑–±—É–≤–∞—é—Ç—å—Å—è!",
            "–õ—é–±–æ–≤ —ñ —Ç–µ–ø–ª–æ —É —Ç–≤–æ—î–º—É –¥–æ–º—ñ!",
            "–ú–∞–≥—ñ—è –≤—ñ—Ä–∏—Ç—å —É —Ç–µ–±–µ! ‚ú®"
        ];

        // üîä –ö–Ω–æ–ø–∫–∞ –∑–≤—É–∫—É ‚Äî –Ω–µ–∑–∞–ª–µ–∂–Ω–∞ –≤—ñ–¥ AR
        soundBtn.addEventListener('click', () => {
            if (bgMusic.paused) {
                bgMusic.play().catch(e => console.log("üîá Audio failed:", e));
                soundBtn.textContent = 'üîä –í–∏–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫';
            } else {
                bgMusic.pause();
                soundBtn.textContent = 'üîä –£–≤—ñ–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫';
            }
        });

        // –ü–æ–∫–∞–∑ –ø—Ä–æ—Ä–æ—Ü—Ç–≤–∞ –ù–ê –ï–ö–í–ê–¢–û–†–Ü (–æ–Ω–æ–≤–ª–µ–Ω–∞ –≤–µ—Ä—Å—ñ—è –∑ —Ä–∞–Ω–¥–æ–º–æ–º, —á–∞—Å—Ç–∏–Ω–∫–∞–º–∏ —Ç–∞ –∑–≤—É–∫–æ–º)
        function showProphecy() {
            const parent = sphere.parentNode;
            if (!parent) return; // –§—ñ–∫—Å: –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ —ñ—Å–Ω—É–≤–∞–Ω–Ω—è

            const message = prophecies[Math.floor(Math.random() * prophecies.length)]; // –†–∞–Ω–¥–æ–º–Ω–µ –ø—Ä–æ—Ä–æ—Ü—Ç–≤–æ
            // –í–∏–¥–∞–ª—è—î–º–æ —Å—Ç–∞—Ä–∏–π —Ç–µ–∫—Å—Ç
            [...parent.querySelectorAll('[data-prophecy]')].forEach(el => el.remove());

            // –¢–µ–∫—Å—Ç –Ω–∞ –µ–∫–≤–∞—Ç–æ—Ä—ñ: Y=0, Z=0.9 (—Ç—Ä–æ—Ö–∏ –¥–∞–ª—ñ, —â–æ–± –Ω–µ –∑–ª–∏–≤–∞—Ç–∏—Å—è –∑ –∫—É–ª–µ—é)
            const text = document.createElement('a-text');
            text.setAttribute('value', message);
            text.setAttribute('position', '0 0 0.9'); // –ó–±—ñ–ª—å—à–µ–Ω–æ Z –¥–ª—è –∫—Ä–∞—â–æ—ó –≤–∏–¥–∏–º–æ—Å—Ç—ñ
            text.setAttribute('color', '#FFD700'); // –ó–æ–ª–æ—Ç–∏–π ‚Äî —è—Å–∫—Ä–∞–≤–∏–π
            text.setAttribute('width', '3.0'); // –ó–±—ñ–ª—å—à–µ–Ω–æ —à–∏—Ä–∏–Ω—É –¥–ª—è –º–æ–±—ñ–ª—å–Ω–æ–≥–æ
            text.setAttribute('align', 'center');
            // Fallback —à—Ä–∏—Ñ—Ç: –≤–±—É–¥–æ–≤–∞–Ω–∏–π, –±–µ–∑ CDN
            text.setAttribute('font', 'kelsonsans'); // –í–±—É–¥–æ–≤–∞–Ω–∏–π A-Frame —à—Ä–∏—Ñ—Ç (–∑–∞–≤–∂–¥–∏ –¥–æ—Å—Ç—É–ø–Ω–∏–π)
            // –ê–Ω—ñ–º–∞—Ü—ñ—è fade-in: –∑ startEvents –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—é
            text.setAttribute('opacity', '0');
            text.setAttribute('animation__fadein', 
                'property: opacity; from: 0; to: 1; dur: 1500; easing: easeOutCubic; startEvents: startFadeIn'
            );
            // –î–æ–¥–∞—Ç–∫–æ–≤–∞ –∞–Ω—ñ–º–∞—Ü—ñ—è: –ø—É–ª—å—Å–∞—Ü—ñ—è –∫–æ–ª—å–æ—Ä—É –¥–ª—è –º–∞–≥—ñ—ó
            text.setAttribute('animation__pulse', 
                'property: color; from: #FFD700; to: #FF4500; dir: alternate; dur: 500; repeat: 4; startEvents: startFadeIn'
            );
            text.setAttribute('data-prophecy', 'true');
            text.setAttribute('side', 'double');

            parent.appendChild(text);

            // –ú–∞–≥—ñ—á–Ω—ñ –µ—Ñ–µ–∫—Ç–∏: –∑–≤—É–∫, —á–∞—Å—Ç–∏–Ω–∫–∏, –±–ª–∏—Å–∫
            if (!prophecySound.paused && !prophecySound.ended) {
                prophecySound.currentTime = 0;
                prophecySound.play().catch(e => console.log("üîá Prophecy sound failed:", e));
            }
            // –ê–∫—Ç–∏–≤–∞—Ü—ñ—è —á–∞—Å—Ç–∏–Ω–æ–∫
            particles.setAttribute('visible', 'true');
            particles.setAttribute('animation__particles', 'property: opacity; from: 0; to: 1; dur: 500; startEvents: startParticles');
            particles.emit('startParticles');
            // –ë–ª–∏—Å–∫ –∫—É–ª—ñ
            sparkleLight.setAttribute('light: intensity', '1');
            setTimeout(() => sparkleLight.setAttribute('light: intensity', '0'), 2000);

            // –ó–∞–ø—É—Å–∫ fade-in (–∑ –∑–∞—Ç—Ä–∏–º–∫–æ—é –¥–ª—è "–º–∞–≥—ñ—á–Ω–æ–≥–æ" –µ—Ñ–µ–∫—Ç—É)
            setTimeout(() => {
                if (text.parentNode) text.emit('startFadeIn');
            }, 200);

            // Fade-out —á–µ—Ä–µ–∑ 5 —Å–µ–∫ (–ø—ñ—Å–ª—è fade-in + –ø–∞—É–∑–∞)
            setTimeout(() => {
                if (text.parentNode) {
                    text.setAttribute('animation__fadeout', 
                        'property: opacity; to: 0; dur: 1000; startEvents: startFadeOut'
                    );
                    text.emit('startFadeOut');
                    // –í–∏–¥–∞–ª–µ–Ω–Ω—è –ø—ñ—Å–ª—è –∞–Ω—ñ–º–∞—Ü—ñ—ó
                    setTimeout(() => { 
                        if (text.parentNode) text.parentNode.removeChild(text); 
                    }, 1000);
                }
                // –ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ —á–∞—Å—Ç–∏–Ω–∫–∏
                setTimeout(() => {
                    particles.setAttribute('animation__hide', 'property: opacity; to: 0; dur: 500');
                }, 1000);
            }, 5000);
        }

        // –û–±—Ä–æ–±–∫–∞ –º–∞—Ä–∫–µ—Ä–∞
        const target = document.querySelector('[mindar-image-target]');
        if (target) {
            target.addEventListener('targetFound', () => {
                isTargetActive = true;
                loader.setAttribute('visible', 'false');
                sphere.setAttribute('visible', 'true');
                // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ —Ñ–æ–Ω–æ–≤–æ—ó –º—É–∑–∏–∫–∏ –ø—Ä–∏ –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—ñ –º–∞—Ä–∫–µ—Ä–∞ (–∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é)
                if (bgMusic.paused) {
                    bgMusic.play().catch(e => console.log("üîá BG music failed:", e));
                }
            });
            target.addEventListener('targetLost', () => {
                isTargetActive = false;
                loader.setAttribute('visible', 'true');
                sphere.setAttribute('visible', 'false');
                // –ü—Ä–∏ –≤—Ç—Ä–∞—Ç—ñ –º–∞—Ä–∫–µ—Ä–∞ ‚Äî –ø—Ä–∏—Ö–æ–≤—É—î–º–æ –ø—Ä–æ—Ä–æ—Ü—Ç–≤–æ —Ç–∞ –µ—Ñ–µ–∫—Ç–∏
                [...sphere.parentNode.querySelectorAll('[data-prophecy]')].forEach(el => el.remove());
                particles.setAttribute('visible', 'false');
                sparkleLight.setAttribute('light: intensity', '0');
            });
        }

        // ‚úÖ –ö–ª—ñ–∫ –ø–æ –∫—É–ª—ñ ‚Üí –ø—Ä–æ—Ä–æ—Ü—Ç–≤–æ
        sphere.addEventListener('click', (evt) => {
            if (isTargetActive) {
                evt.preventDefault();
                showProphecy();
                console.log("‚ú® –ü—Ä–æ—Ä–æ—Ü—Ç–≤–æ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ!");
            }
        });

        // üì± –ú–æ–±—ñ–ª—å–Ω–∏–π fallback: —Ç–æ—Ä–∫–∞–Ω–Ω—è –µ–∫—Ä–∞–Ω—É (–æ–∫—Ä—ñ–º –∫–Ω–æ–ø–∫–∏) ‚Üí –ø—Ä–æ—Ä–æ—Ü—Ç–≤–æ
        document.body.addEventListener('touchstart', (e) => {
            if (isTargetActive) {
                // –Ø–∫—â–æ —Ç–æ—Ä–∫–Ω—É–ª–∏—Å—è –Ω–µ –∫–Ω–æ–ø–∫–∏ ‚Äî –∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏ –ø—Ä–æ—Ä–æ—Ü—Ç–≤–æ
                if (!e.target.closest('#sound-btn')) {
                    e.preventDefault();
                    showProphecy();
                }
            }
        }, { passive: false });
    </script>
</body>
</html>
