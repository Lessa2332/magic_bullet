<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üéÑ –†—ñ–∑–¥–≤—è–Ω–∞ –ú–∞–≥—ñ—á–Ω–∞ –ö—É–ª—è</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.3/dist/mindar-image-aframe.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-effects@1.0.0/dist/aframe-effects.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: transparent;
            font-family: 'Arial Rounded MT Bold', Arial, sans-serif;
            color: white;
        }

        a-scene {
            position: fixed;
            top: 0;
            left: 0;
            width: 100% !important;
            height: 100% !important;
            background: transparent;
        }

        .loader {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(10, 15, 44, 0.95);
            z-index: 1000;
            text-align: center;
            padding: 20px;
        }

        .loader h1 {
            font-size: 2em;
            margin-bottom: 15px;
            text-shadow: 0 0 15px #00b0ff;
            animation: glow 2s infinite alternate;
        }

        .loader p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        @keyframes glow {
            from { text-shadow: 0 0 10px #00b0ff; }
            to { text-shadow: 0 0 20px #ff00ff, 0 0 30px #00b0ff; }
        }

        .sound-btn {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1001;
            padding: 12px 24px;
            border: none;
            border-radius: 24px;
            background: linear-gradient(45deg, #00b0ff, #ff00ff);
            color: white;
            font-weight: bold;
            cursor: pointer;
            font-size: 1em;
            backdrop-filter: blur(10px);
        }

        .particles-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }
    </style>
</head>
<body>
    <div class="loader" id="loader">
        <h1>üéÑ –†—ñ–∑–¥–≤—è–Ω–∞ –ú–∞–≥—ñ—á–Ω–∞ –ö—É–ª—è</h1>
        <p>–ù–∞–≤–µ–¥–∏ –∫–∞–º–µ—Ä—É –Ω–∞ –º–∞—Ä–∫–µ—Ä, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ –¥–∏–≤–æ!</p>
    </div>

    <a-scene
        mindar-image="imageTargetSrc: assets/marker.mind; maxTrack: 1"
        embedded
        renderer="colorManagement: true; physicallyCorrectLights: true;"
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false"
        loading-screen="enabled: false"
    >
        <a-assets>
            <audio id="bg-music" src="fon.mp3" preload="auto" loop></audio>
            <img id="env-map" src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@dev/examples/textures/sphere/cube_panorama.jpg" crossorigin="anonymous">
            
            <!-- –®–µ–π–¥–µ—Ä–∏ -->
            <script id="vertexShader" type="x-shader/x-vertex">
                varying vec3 vNormal;
                varying vec3 vWorldPosition;
                varying vec2 vUv;

                void main() {
                    vNormal = normalize(normalMatrix * normal);
                    vec4 worldPosition = modelMatrix * vec4(position, 1.0);
                    vWorldPosition = worldPosition.xyz;
                    vUv = uv;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                }
            </script>

            <script id="fragmentShader" type="x-shader/x-fragment">
                uniform float time;
                uniform sampler2D envMap;
                varying vec3 vNormal;
                varying vec3 vWorldPosition;
                varying vec2 vUv;

                void main() {
                    // –†–µ—Ñ—Ä–∞–∫—Ü—ñ—è —Ç–∞ –≤—ñ–¥–±–∏—Ç—Ç—è
                    vec3 viewDirection = normalize(cameraPosition - vWorldPosition);
                    vec3 normal = normalize(vNormal);
                    
                    // –î–∏—Å—Ç–æ—Ä—Å—ñ—è –¥–ª—è —Å–∫–ª—è–Ω–æ–≥–æ –µ—Ñ–µ–∫—Ç—É
                    float distortion = sin(time + vWorldPosition.x * 3.0) * 0.1 + 
                                      cos(time + vWorldPosition.y * 3.0) * 0.1;
                    
                    // –ö–æ–ª—å–æ—Ä–æ–≤—ñ —Å–ø–∞–ª–∞—Ö–∏
                    vec3 sparkles = vec3(
                        sin(time * 2.0 + vWorldPosition.x * 10.0) * 0.3,
                        cos(time * 1.5 + vWorldPosition.y * 8.0) * 0.3,
                        sin(time * 1.8 + vWorldPosition.z * 6.0) * 0.3
                    );
                    
                    // –û—Å–Ω–æ–≤–Ω–∏–π –∫–æ–ª—ñ—Ä –∑ –≥—Ä–∞–¥—ñ—î–Ω—Ç–æ–º
                    vec3 baseColor = mix(vec3(0.1, 0.4, 0.8), vec3(0.8, 0.2, 0.6), vUv.y);
                    
                    // –§—Ä–µ–Ω—Å–µ–ª—å –µ—Ñ–µ–∫—Ç
                    float fresnel = pow(1.0 - dot(normal, viewDirection), 3.0);
                    
                    // –§—ñ–Ω–∞–ª—å–Ω–∏–π –∫–æ–ª—ñ—Ä
                    vec3 finalColor = baseColor + sparkles + fresnel * vec3(0.5, 0.8, 1.0);
                    
                    // –ü—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å –∑ –≤–∞—Ä—ñ–∞—Ü—ñ—è–º–∏
                    float alpha = 0.3 + fresnel * 0.3 + length(sparkles) * 0.2;
                    
                    gl_FragColor = vec4(finalColor, alpha);
                }
            </script>
        </a-assets>

        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

        <!-- –°–≤—ñ—Ç–ª–æ -->
        <a-light type="ambient" color="#4455aa" intensity="0.3"></a-light>
        <a-light type="directional" color="#ff4444" intensity="0.8" position="2 5 3"></a-light>
        <a-light type="point" color="#4444ff" intensity="1.0" position="-3 2 1"></a-light>
        <a-light type="point" color="#44ff44" intensity="0.6" position="1 -2 2"></a-light>

        <a-entity mindar-image-target="targetIndex: 0">
            <!-- –ú–∞–≥—ñ—á–Ω–∞ —Å–∫–ª—è–Ω–∞ –∫—É–ª—è –∑ –∫–∞—Å—Ç–æ–º–Ω–∏–º —à–µ–π–¥–µ—Ä–æ–º -->
            <a-entity
                id="magic-sphere"
                geometry="primitive: sphere; radius: 0.8"
                position="0 0.5 0"
                visible="false"
                class="clickable"
            >
                <!-- –ê–Ω—ñ–º–∞—Ü—ñ—è –ø–ª–∞–≤–Ω–æ–≥–æ —Å–ø–ª–∏–≤–∞–Ω–Ω—è -->
                <a-animation
                    attribute="position"
                    from="0 -1 0"
                    to="0 0.5 0"
                    dur="2000"
                    easing="easeOutElastic"
                ></a-animation>
                
                <!-- –ê–Ω—ñ–º–∞—Ü—ñ—è –æ–±–µ—Ä—Ç–∞–Ω–Ω—è -->
                <a-animation
                    attribute="rotation"
                    to="0 360 0"
                    dur="15000"
                    repeat="indefinite"
                    easing="linear"
                ></a-animation>
            </a-entity>

            <!-- –ß–∞—Å—Ç–∏–Ω–∫–∏ –Ω–∞–≤–∫–æ–ª–æ –∫—É–ª—ñ -->
            <a-entity
                id="particles"
                particle-system="preset: snow; color: #00B0FF, #FF00FF; particleCount: 150"
                position="0 0.5 0"
                visible="false"
            ></a-entity>
        </a-entity>
    </a-scene>

    <button class="sound-btn" id="sound-btn">üîä –£–≤—ñ–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫</button>

    <script>
        const loader = document.getElementById('loader');
        const sphere = document.getElementById('magic-sphere');
        const particles = document.getElementById('particles');
        const bgMusic = document.getElementById('bg-music');
        const soundBtn = document.getElementById('sound-btn');

        let scene, camera, renderer;
        let customSphere, clock;
        let prophecyText = null;

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ —à–µ–π–¥–µ—Ä–∞
        function initCustomShader() {
            scene = document.querySelector('a-scene').object3D;
            
            const vertexShader = document.getElementById('vertexShader').textContent;
            const fragmentShader = document.getElementById('fragmentShader').textContent;
            
            const uniforms = {
                time: { value: 0 },
                envMap: { value: null }
            };
            
            const shaderMaterial = new THREE.ShaderMaterial({
                vertexShader: vertexShader,
                fragmentShader: fragmentShader,
                uniforms: uniforms,
                transparent: true,
                side: THREE.DoubleSide,
                blending: THREE.AdditiveBlending
            });
            
            // –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –º–∞—Ç–µ—Ä—ñ–∞–ª—É –¥–æ —Å—Ñ–µ—Ä–∏
            sphere.addEventListener('model-loaded', () => {
                const mesh = sphere.getObject3D('mesh');
                if (mesh) {
                    mesh.material = shaderMaterial;
                    customSphere = mesh;
                }
            });
            
            clock = new THREE.Clock();
            
            // –ê–Ω—ñ–º–∞—Ü—ñ—è —à–µ–π–¥–µ—Ä–∞
            function animateShader() {
                if (customSphere && customSphere.material.uniforms.time) {
                    customSphere.material.uniforms.time.value = clock.getElapsedTime();
                }
                requestAnimationFrame(animateShader);
            }
            animateShader();
        }

        // –ü–æ–∫—Ä–∞—â–µ–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –ø—Ä–æ—Ä–æ—Ü—Ç–≤–∞
        function showProphecy() {
            const parent = sphere.parentNode;
            
            // –í–∏–¥–∞–ª—è—î–º–æ —Å—Ç–∞—Ä–∏–π —Ç–µ–∫—Å—Ç
            if (prophecyText) {
                parent.removeChild(prophecyText);
            }

            const messages = [
                "–©–∞—Å–ª–∏–≤–æ–≥–æ –†—ñ–∑–¥–≤–∞! üéÑ",
                "–ú–∏—Ä —Ç–∞ –¥–æ–±—Ä–æ —É –≤–∞—à–æ–º—É –¥–æ–º—ñ! ‚ú®",
                "–ù–µ—Ö–∞–π –∞–Ω–≥–µ–ª–∏ –±–µ—Ä–µ–∂—É—Ç—å –≤–∞—Å! üåü",
                "–õ—é–±–æ–≤ —ñ —Å–≤—ñ—Ç–ª–æ —Ü—ñ–ª–∏–π —Ä—ñ–∫! üí´"
            ];
            
            const message = messages[Math.floor(Math.random() * messages.length)];

            // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç—É –∑ –µ—Ñ–µ–∫—Ç–∞–º–∏
            prophecyText = document.createElement('a-entity');
            prophecyText.setAttribute('position', '0 1.8 0');
            prophecyText.setAttribute('text', {
                value: message,
                color: '#FFD700',
                align: 'center',
                width: 3,
                font: 'https://cdn.aframe.io/fonts/Roboto-msdf.json'
            });

            // –ê–Ω—ñ–º–∞—Ü—ñ—è –ø–æ—è–≤–∏
            prophecyText.setAttribute('animation', {
                property: 'scale',
                from: '0 0 0',
                to: '1 1 1',
                dur: 1000,
                easing: 'easeOutElastic'
            });

            parent.appendChild(prophecyText);

            // –ï—Ñ–µ–∫—Ç —á–∞—Å—Ç–∏–Ω–æ–∫ –ø—Ä–∏ –ø–æ—è–≤—ñ —Ç–µ–∫—Å—Ç—É
            particles.emit('emit');

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–Ω–∏–∫–Ω–µ–Ω–Ω—è
            setTimeout(() => {
                if (prophecyText && prophecyText.parentNode) {
                    prophecyText.setAttribute('animation', {
                        property: 'scale',
                        to: '0 0 0',
                        dur: 800,
                        easing: 'easeInCubic'
                    });
                    setTimeout(() => {
                        if (prophecyText.parentNode) {
                            prophecyText.parentNode.removeChild(prophecyText);
                            prophecyText = null;
                        }
                    }, 800);
                }
            }, 5000);
        }

        // –û–±—Ä–æ–±–∫–∞ –ø–æ–¥—ñ–π AR
        const target = document.querySelector('[mindar-image-target]');
        if (target) {
            target.addEventListener('targetFound', () => {
                loader.style.display = 'none';
                sphere.setAttribute('visible', 'true');
                particles.setAttribute('visible', 'true');
                
                // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —à–µ–π–¥–µ—Ä–∞ –ø—ñ—Å–ª—è –ø–æ—è–≤–∏
                setTimeout(initCustomShader, 100);
                
                // –ê–≤—Ç–æ–ø–ª–µ–π –∑–≤—É–∫—É
                if (bgMusic.paused) {
                    const playPromise = bgMusic.play();
                    if (playPromise !== undefined) {
                        playPromise.catch(e => {
                            console.log("üîá –ê–≤—Ç–æ–≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ");
                            soundBtn.style.display = 'block';
                        });
                    }
                    soundBtn.textContent = 'üîä –í–∏–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫';
                }
            });

            target.addEventListener('targetLost', () => {
                loader.style.display = 'flex';
                sphere.setAttribute('visible', 'false');
                particles.setAttribute('visible', 'false');
                if (!bgMusic.paused) bgMusic.pause();
                soundBtn.textContent = 'üîä –£–≤—ñ–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫';
            });
        }

        // –ö–ª—ñ–∫ –ø–æ –∫—É–ª—ñ
        sphere.addEventListener('click', showProphecy);

        // –ö–Ω–æ–ø–∫–∞ –∑–≤—É–∫—É
        soundBtn.addEventListener('click', () => {
            if (bgMusic.paused) {
                bgMusic.play();
                soundBtn.textContent = 'üîä –í–∏–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫';
            } else {
                bgMusic.pause();
                soundBtn.textContent = 'üîä –£–≤—ñ–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫';
            }
        });

        // –î–æ–¥–∞—Ç–∫–æ–≤—ñ –µ—Ñ–µ–∫—Ç–∏ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        window.addEventListener('load', () => {
            // –î–æ–¥–∞—î–º–æ –≤–∏–ø–∞–¥–∫–æ–≤—ñ –±–ª–∏–º–∞—é—á—ñ –∑—ñ—Ä–æ—á–∫–∏ –Ω–∞ –ª–æ–∞–¥–µ—Ä
            createLoadingStars();
        });

        function createLoadingStars() {
            const starsContainer = document.createElement('div');
            starsContainer.className = 'particles-container';
            document.body.appendChild(starsContainer);

            for (let i = 0; i < 20; i++) {
                const star = document.createElement('div');
                star.style.cssText = `
                    position: absolute;
                    width: ${Math.random() * 4 + 2}px;
                    height: ${Math.random() * 4 + 2}px;
                    background: white;
                    border-radius: 50%;
                    left: ${Math.random() * 100}%;
                    top: ${Math.random() * 100}%;
                    animation: twinkle ${Math.random() * 3 + 2}s infinite alternate;
                    box-shadow: 0 0 10px #00b0ff;
                `;
                starsContainer.appendChild(star);
            }

            // –î–æ–¥–∞—î–º–æ CSS –∞–Ω—ñ–º–∞—Ü—ñ—é
            const style = document.createElement('style');
            style.textContent = `
                @keyframes twinkle {
                    0% { opacity: 0.2; transform: scale(0.8); }
                    100% { opacity: 1; transform: scale(1.2); box-shadow: 0 0 20px #ff00ff; }
                }
            `;
            document.head.appendChild(style);
        }
    </script>
</body>
</html>
