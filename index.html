<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üéÑ –†—ñ–∑–¥–≤—è–Ω–∞ –ú–∞–≥—ñ—á–Ω–∞ –ö—É–ª—è</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.3/dist/mindar-image-aframe.prod.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body {
            width: 100%; height: 100%; overflow: hidden;
            background: #000;
            font-family: Arial, sans-serif;
        }
        a-scene {
            position: fixed; top: 0; left: 0;
            width: 100% !important; height: 100% !important;
            background: transparent;
        }
        #sound-btn {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10000;
            padding: 12px 24px;
            border: none;
            border-radius: 24px;
            background: linear-gradient(45deg, #00b0ff, #ff00ff);
            color: white;
            font-weight: bold;
            cursor: pointer;
            font-size: 1em;
            pointer-events: auto;
        }
        /* Fallback –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –¥–ª—è –∫–∞–º–µ—Ä–∏ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø—ñ (–∑–∞–º—ñ–Ω—ñ—Ç—å src –Ω–∞ —Ä–µ–∞–ª—å–Ω–µ –≤—ñ–¥–µ–æ/–∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è) */
        #camera-fallback {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: -1;
            object-fit: cover;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Fallback: —Ç–µ—Å—Ç–æ–≤–µ –≤—ñ–¥–µ–æ (–∑–∞–º—ñ–Ω—ñ—Ç—å src –Ω–∞ –≤–∞—à–µ, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ª–æ–∫–∞–ª—å–Ω–µ 'bg.mp4') -->
    <video id="camera-fallback" src="https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4" autoplay loop muted playsinline></video>
    
    <button id="sound-btn">üîä –£–≤—ñ–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫</button>
    <a-scene
        mindar-image="imageTargetSrc: assets/marker.mind; maxTrack: 1; debugMode: true"
        embedded
        renderer="colorManagement: true; physicallyCorrectLights: true;"
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false"
        loading-screen="enabled: false"
        cursor="rayOrigin: mouse"
    >
        <a-assets>
            <audio id="bg-music" src="fon.mp3" preload="auto" loop></audio>
            <audio id="prophecy-sound" src="sparkle.mp3" preload="auto"></audio>
        </a-assets>
        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>
        <a-entity mindar-image-target="targetIndex: 0">
            <a-sphere
                id="magic-sphere"
                radius="0.8"
                position="0 0 0"
                material="
                    color: #00b0ff;
                    transparent: true;
                    opacity: 0.35;
                    shader: standard;
                    emissive: #0080ff;
                    emissiveIntensity: 0.2;
                    metalness: 0.1;
                    roughness: 0.3;
                    side: double
                "
                visible="false"
            >
                <a-animation
                    attribute="rotation"
                    to="0 360 0"
                    dur="10000"
                    repeat="indefinite"
                ></a-animation>
                <a-entity id="sparkle-light" light="type: point; intensity: 0; color: #FFD700" position="0 0 0"></a-entity>
            </a-sphere>
            <a-entity id="particles" particle-system="
                preset: dust;
                color: #FFD700,#FF00FF,#00B0FF;
                particleCount: 200;
                velocityValue: 0 0 0;
                velocitySpread: 2 2 2;
                accelerationValue: 0 -9.8 0;
                accelerationSpread: 0 0 0;
                startSize: 0.05;
                endSize: 0.01;
                startOpacity: 1;
                endOpacity: 0;
                duration: 3;
                opacity: 0;
            " position="0 0 0" visible="false"></a-entity>
        </a-entity>
        <!-- –ü–æ–∫—Ä–∞—â–µ–Ω–∏–π –ª–æ–∞–¥–µ—Ä –∑ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è–º–∏ -->
        <a-entity id="loader" position="0 0 -2" visible="true">
            <a-plane width="3" height="1.5" color="#0a0f2c" opacity="0.8" side="double"></a-plane>
            <a-text value="–ù–∞–≤–µ–¥–∏ –∫–∞–º–µ—Ä—É –Ω–∞ –º–∞—Ä–∫–µ—Ä!\n(–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ HTTPS + –º–æ–±—ñ–ª—å–Ω–∏–π –¥–ª—è –∫–∞–º–µ—Ä–∏)" align="center" color="#00b0ff" width="2.8" position="0 0 0.01" font="kelsonsans"></a-text>
        </a-entity>
    </a-scene>
    <script>
        const bgMusic = document.getElementById('bg-music');
        const prophecySound = document.getElementById('prophecy-sound');
        const loader = document.getElementById('loader');
        const sphere = document.getElementById('magic-sphere');
        const sparkleLight = document.getElementById('sparkle-light');
        const particles = document.getElementById('particles');
        const soundBtn = document.getElementById('sound-btn');
        const cameraFallback = document.getElementById('camera-fallback');
        const scene = document.querySelector('a-scene');
        let isTargetActive = false;
        let isMobileAR = false;
        
        const prophecies = [
            "–©–∞—Å–ª–∏–≤–æ–≥–æ –†—ñ–∑–¥–≤–∞!",
            "–ë–∞–∂–∞—é –¥–∏–≤–∞ –≤ –ù–æ–≤–æ–º—É —Ä–æ—Ü—ñ!",
            "–ù–µ—Ö–∞–π –º—Ä—ñ—ó –∑–±—É–≤–∞—é—Ç—å—Å—è!",
            "–õ—é–±–æ–≤ —ñ —Ç–µ–ø–ª–æ —É —Ç–≤–æ—î–º—É –¥–æ–º—ñ!",
            "–ú–∞–≥—ñ—è –≤—ñ—Ä–∏—Ç—å —É —Ç–µ–±–µ! ‚ú®"
        ];

        // –í–∏—è–≤–ª–µ–Ω–Ω—è –¥–µ—Å–∫—Ç–æ–ø—É/fallback
        isMobileAR = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        if (!isMobileAR) {
            console.log("üñ•Ô∏è –î–µ—Å–∫—Ç–æ–ø: –£–≤—ñ–º–∫–Ω–µ–Ω–æ fallback –±–µ–∑ AR-–∫–∞–º–µ—Ä–∏");
            cameraFallback.style.display = 'block';
            cameraFallback.play().catch(e => console.log("Fallback video failed:", e)); // –§—ñ–∫—Å: –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫
            loader.setAttribute('visible', 'false');
            sphere.setAttribute('visible', 'true');
            isTargetActive = true;
        }

        // –ö–Ω–æ–ø–∫–∞ –∑–≤—É–∫—É
        soundBtn.addEventListener('click', () => {
            if (bgMusic.paused) {
                bgMusic.play().catch(e => console.log("üîá Audio failed:", e));
                soundBtn.textContent = 'üîä –í–∏–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫';
            } else {
                bgMusic.pause();
                soundBtn.textContent = 'üîä –£–≤—ñ–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫';
            }
        });

        // –§—É–Ω–∫—Ü—ñ—è –ø—Ä–æ—Ä–æ—Ü—Ç–≤–∞
        function showProphecy() {
            const parent = sphere.parentNode;
            if (!parent) return;

            const message = prophecies[Math.floor(Math.random() * prophecies.length)];
            [...parent.querySelectorAll('[data-prophecy]')].forEach(el => el.remove());

            const text = document.createElement('a-text');
            text.setAttribute('value', message);
            text.setAttribute('position', '0 0 0.9');
            text.setAttribute('color', '#FFD700');
            text.setAttribute('width', '3.5');
            text.setAttribute('align', 'center');
            text.setAttribute('font', 'kelsonsans');
            text.setAttribute('opacity', '0');
            text.setAttribute('animation__fadein', 
                'property: opacity; from: 0; to: 1; dur: 1500; easing: easeOutCubic; startEvents: startFadeIn'
            );
            text.setAttribute('animation__pulse', 
                'property: color; from: #FFD700; to: #FF4500; dir: alternate; dur: 500; repeat: 4; startEvents: startFadeIn'
            );
            text.setAttribute('data-prophecy', 'true');
            text.setAttribute('side', 'double');

            parent.appendChild(text);

            // –ï—Ñ–µ–∫—Ç–∏ (–∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞–º–∏)
            if (prophecySound) {
                prophecySound.currentTime = 0;
                prophecySound.play().catch(e => console.log("üîá Prophecy sound:", e));
            }
            particles.setAttribute('visible', 'true');
            particles.setAttribute('animation__particles', 'property: opacity; from: 0; to: 1; dur: 500; startEvents: startParticles');
            particles.emit('startParticles');
            sparkleLight.setAttribute('light: intensity', '1');
            setTimeout(() => sparkleLight.setAttribute('light: intensity', '0'), 2000);

            setTimeout(() => {
                if (text.parentNode) text.emit('startFadeIn');
            }, 200);

            setTimeout(() => {
                if (text.parentNode) {
                    text.setAttribute('animation__fadeout', 'property: opacity; to: 0; dur: 1000; startEvents: startFadeOut');
                    text.emit('startFadeOut');
                    setTimeout(() => { if (text.parentNode) text.parentNode.removeChild(text); }, 1000);
                }
                setTimeout(() => {
                    particles.setAttribute('visible', 'false');
                    particles.setAttribute('animation__particles', null); // –û—á–∏—â–µ–Ω–Ω—è –∞–Ω—ñ–º–∞—Ü—ñ—ó –¥–ª—è –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Ä–∞–∑—É
                }, 1000);
            }, 5000);
        }

        // –û–±—Ä–æ–±–∫–∞ MindAR (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π —Å—Ç–∞—Ä—Ç, –∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é)
        const startMindAR = () => {
            scene.addEventListener('renderstart', () => {
                console.log("üé• A-Frame —Ä–µ–Ω–¥–µ—Ä —Å—Ç–∞—Ä—Ç—É–≤–∞–≤");
                const mindar = scene.components['mindar-image'];
                if (mindar && !mindar.isStarted) { // –§—ñ–∫—Å: –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –≤–∂–µ –∑–∞–ø—É—â–µ–Ω–∏–π
                    mindar.start().then(() => {
                        console.log("‚úÖ MindAR/–∫–∞–º–µ—Ä–∞ –∞–∫—Ç–∏–≤–Ω–∞!");
                        if (cameraFallback) cameraFallback.style.display = 'none';
                    }).catch(err => {
                        console.error("‚ùå MindAR –ø–æ–º–∏–ª–∫–∞ (–º–∞—Ä–∫–µ—Ä/permissions):", err);
                    });
                } else {
                    console.log("MindAR –≤–∂–µ –∑–∞–ø—É—â–µ–Ω–∏–π –∞–±–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π");
                }
            });
        };

        // AR –ø–æ–¥—ñ—ó
        const target = document.querySelector('[mindar-image-target]');
        if (target) {
            startMindAR();
            target.addEventListener('targetFound', () => {
                isTargetActive = true;
                loader.setAttribute('visible', 'false');
                sphere.setAttribute('visible', 'true');
                if (bgMusic && bgMusic.paused) {
                    bgMusic.play().catch(e => console.log("üîá BG music:", e));
                }
            });
            target.addEventListener('targetLost', () => {
                isTargetActive = false;
                loader.setAttribute('visible', 'true');
                sphere.setAttribute('visible', 'false');
                [...document.querySelectorAll('[data-prophecy]')].forEach(el => el.remove());
                particles.setAttribute('visible', 'false');
                sparkleLight.setAttribute('light: intensity', '0');
            });
        }

        // –ö–ª—ñ–∫/—Ç–∞—á ‚Üí –ø—Ä–æ—Ä–æ—Ü—Ç–≤–æ
        sphere.addEventListener('click', (evt) => {
            if (isTargetActive || !isMobileAR) {
                evt.preventDefault();
                showProphecy();
                console.log("‚ú® –ü—Ä–æ—Ä–æ—Ü—Ç–≤–æ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ!");
            }
        });

        document.body.addEventListener('touchstart', (e) => {
            if ((isTargetActive || !isMobileAR) && !e.target.closest('#sound-btn')) {
                e.preventDefault();
                showProphecy();
            }
        }, { passive: false });
    </script>
</body>
</html>
